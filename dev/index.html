<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FoldsThreads.jl · FoldsThreads</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">FoldsThreads</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>FoldsThreads.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>FoldsThreads.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FoldsThreads.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="FoldsThreads.jl"><a class="docs-heading-anchor" href="#FoldsThreads.jl">FoldsThreads.jl</a><a id="FoldsThreads.jl-1"></a><a class="docs-heading-anchor-permalink" href="#FoldsThreads.jl" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="FoldsThreads.FoldsThreads" href="#FoldsThreads.FoldsThreads"><code>FoldsThreads.FoldsThreads</code></a> — <span class="docstring-category">Module</span></header><section><div><p><strong>FoldsThreads: Extra threaded executors for JuliaFolds/*.jl</strong></p><p>FoldsThreads.jl provides extra thread-based executors usable with various JuliaFolds/*.jl packages such as <a href="https://github.com/JuliaFolds/Transducers.jl">Transducers.jl</a> and <a href="https://github.com/JuliaFolds/FLoops.jl">FLoops.jl</a>.</p><pre><code class="language-none">                                  Executors
                           ,----------------------.
     Algorithms            |    FoldsThreads.jl    |         Data structures
,------------------.       |-----------------------|       ,-----------------.
|  FLoops,         |       |  ThreadedEx*          |       |  Array,         |
|  Folds,          |       |  WorkStealingEx,      |       |  Tables,        |
|  Transducers,    |  ---  |  DepthFirstEx,        |  ---  |  FGenerators,   |
|  OnlineStats,    |       |  TaskPoolEx,          |       |  Dict,          |
|  DataTools, ...  &#39;       |  NondeterministicEx,  |       |  Set, ...       |
`------------------&#39;       |  ...                  |       `-----------------&#39;
                           `-----------------------&#39;</code></pre><p>(* <code>ThreadedEx</code> is the default executor provided by Transducers.jl)</p><ul><li><code>WorkStealingEx</code> implements work stealing (continuation stealing). Useful for load-balancing.</li><li><code>DepthFirstEx</code> implements depth-first scheduling. Useful for <code>findfirst</code>-type computations.</li><li><code>TaskPoolEx</code>: Task pool executor. Useful for fine execution control (e.g., back pressure and &quot;background&quot; threads).</li><li><code>NondeterministicEx</code>: An executor for parallelizing computations with non-parallelizable iterators.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/c51327fb643d7be88c646581293a98cbaf579827/src/misc.jl#L16-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FoldsThreads.DepthFirstEx" href="#FoldsThreads.DepthFirstEx"><code>FoldsThreads.DepthFirstEx</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">DepthFirstEx(; [simd,] [basesize])</code></pre><p>Depth-first scheduling for parallel execution. Useful for <code>findfirst</code>-type of computation.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using Folds

julia&gt; Folds.sum(i -&gt; gcd(i, 42), 1:1000_000, DepthFirstEx())
4642844</code></pre><p><strong>Extended help</strong></p><p><code>DepthFirstEx</code> schedules chunks of size roughly equal to <code>basesize</code> in the ordered that each chunk appears in the input collection. The basecase computation does not wait for all the tasks to be scheduled. This approach performs better than a more naive approach where the all tasks are scheduled before the reduction starts.  <code>DepthFirstEx</code> is useful for reductions that can terminate early (e.g., <code>findfirst</code>, <code>@floop</code> with <code>break</code>).</p><p><strong>Keyword Arguments</strong></p><ul><li><code>basesize</code>: The size of base case.</li><li><code>simd</code>: <code>false</code>, <code>true</code>, <code>:ivdep</code>, or <code>Val</code> of one of them.  If <code>true</code>/<code>:ivdep</code>, the inner-most loop of each base case is annotated by <code>@simd</code>/<code>@simd ivdep</code>.  Use a plain loop if <code>false</code> (default).</li></ul><p><strong>More examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using FLoops

julia&gt; @floop DepthFirstEx() for x in 1:1000_000
           y = gcd(x, 42)
           @reduce(acc += y)
       end
       acc
4642844</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/c51327fb643d7be88c646581293a98cbaf579827/src/misc.jl#L16-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FoldsThreads.NondeterministicEx" href="#FoldsThreads.NondeterministicEx"><code>FoldsThreads.NondeterministicEx</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">NondeterministicEx(; [simd,] [basesize,] [ntasks,])</code></pre><p>Batched parallel reduction for non-parallelizable collections (e.g., <code>Channel</code>, <code>Iterators.Stateful</code>).</p><p>This is a simple wrapper of <a href="https://juliafolds.github.io/Transducers.jl/dev/reference/manual/#Transducers.NondeterministicThreading"><code>NondeterministicThreading</code></a> transducer. Use <code>NondeterministicThreading</code> directly for explicit control on what transducers are parallelized.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using Folds

julia&gt; partially_parallelizable(seq) = (gcd(y, 42) for x in seq for y in 1:10000x);

julia&gt; Folds.sum(partially_parallelizable(Iterators.Stateful(1:100)), NondeterministicEx())
234462500</code></pre><p>In the above example, we can run <code>gcd(y, 42)</code> (mapping), <code>for y in 1:10000x</code> (flattening), and <code>+</code> for <code>sum</code> (reduction) in parallel even though the iteration of <code>Iterators.Stateful(1:100)</code> is not parallelizable. Note that, as indicated in the example, the computation per each iteration of the non-parallelizable collection should be very CPU-intensive in order for <code>NondeterministicEx</code> to show any kind of performance benefits.</p><p>Same computation using FLoops.jl:</p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using FLoops

julia&gt; @floop NondeterministicEx() for x in Iterators.Stateful(1:100)
           for y in 1:10000x
               z = gcd(y, 42)
               @reduce(acc += z)
           end
       end
       acc
234462500</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/c51327fb643d7be88c646581293a98cbaf579827/src/misc.jl#L16-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FoldsThreads.TaskPoolEx" href="#FoldsThreads.TaskPoolEx"><code>FoldsThreads.TaskPoolEx</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">TaskPoolEx(; [simd,] [basesize,] [ntasks,] [background,])</code></pre><p>Executor using pooled tasks for reduction. Useful for reductions with I/O and managing back pressure. With <code>background = true</code>, it can also be used to isolate throughput-oriented tasks and use the primary thread for latency-oriented tasks.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using Folds

julia&gt; Folds.sum(i -&gt; gcd(i, 42), 1:1000_000, TaskPoolEx())
4642844</code></pre><p><strong>Extended help</strong></p><p>Worker tasks are pooled (for each executor) so that the number of Julia <code>Task</code>s used for a reduction can be much smaller than <code>input_length ÷ basesize</code>. This strategy is used mainly for limiting resource (e.g., memory) required by the reduction than for load-balancing. <code>WorkStealingEx</code> performs better for load-balancing of compute-intensive reductions.</p><p><strong>NOTE:</strong> This executor is inspired by <a href="https://github.com/tro3/ThreadPools.jl">ThreadPools.jl</a>. The hack for assigning a task to a dedicated thread is stolen from ThreadPools.jl.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p><strong>It is highly discouraged to use this executor in Julia <em>packages</em></strong>; especially those that are used as libraries rather than end-user applications. This is because the whole purpose of this executor is to <em>prevent</em> Julia runtime from doing the right thing for managing tasks. Ideally, the library user should be able to pass an executor as an argument so that your library function can be used with any executors including <code>TaskPoolEx</code>.</p></div></div><p><strong>Keyword Arguments</strong></p><ul><li><code>background = false</code>: Do not run tasks on <code>threadid() == 1</code>.</li><li><code>ntasks</code>: The number of tasks to be used.</li><li><code>basesize</code>: The size of base case.</li><li><code>simd</code>: <code>false</code>, <code>true</code>, <code>:ivdep</code>, or <code>Val</code> of one of them.  If <code>true</code>/<code>:ivdep</code>, the inner-most loop of each base case is annotated by <code>@simd</code>/<code>@simd ivdep</code>.  Use a plain loop if <code>false</code> (default).</li></ul><p><strong>More examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using FLoops

julia&gt; @floop TaskPoolEx() for x in 1:1000_000
           y = gcd(x, 42)
           @reduce(acc += y)
       end
       acc
4642844</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/c51327fb643d7be88c646581293a98cbaf579827/src/misc.jl#L16-L76">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FoldsThreads.WorkStealingEx" href="#FoldsThreads.WorkStealingEx"><code>FoldsThreads.WorkStealingEx</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">WorkStealingEx(; [simd,] [basesize])</code></pre><p>Work-stealing scheduling for parallel (but not concurrent) execution. Useful for load-balancing.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using Folds

julia&gt; Folds.sum(i -&gt; gcd(i, 42), 1:1000_000, WorkStealingEx())
4642844</code></pre><p><strong>Extended help</strong></p><p><code>WorkStealingEx</code> implements <a href="https://en.wikipedia.org/wiki/Work_stealing">work stealing scheduler</a> for Transducers.jl and other JuliaFolds/*.jl packages. Worker tasks are pooled (for each executor) so that the number of Julia <code>Task</code>s used for a reduction can be much smaller than <code>input_length ÷ basesize</code>. This has a positive impact for reduction that requires load-balancing since this does not incur the overhead of spawning tasks. However, as the worker tasks are occupied by a base case until the base case is fully reduced, the user functions (reducing functions and transducers) cannot use concurrency primitives such as channels and semaphores to communicate <em>within them</em>. See below for discussion on usable concurrency patterns.</p><p><strong>NOTE:</strong> <code>WorkStealingEx</code> is more experimental than the default multi-thread executor <code>ThreadedEx</code>. Importantly, <code>WorkStealingEx</code> still does not perform well than <code>ThreadedEx</code> for parallel computation that does not require load-balancing.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>basesize</code>: The size of base case.</li><li><code>simd</code>: <code>false</code>, <code>true</code>, <code>:ivdep</code>, or <code>Val</code> of one of them.  If <code>true</code>/<code>:ivdep</code>, the inner-most loop of each base case is annotated by <code>@simd</code>/<code>@simd ivdep</code>.  Use a plain loop if <code>false</code> (default).</li></ul><p><strong>More examples</strong></p><pre><code class="language-julia-repl">julia&gt; using FoldsThreads
       using FLoops

julia&gt; @floop WorkStealingEx() for x in 1:1000_000
           y = gcd(x, 42)
           @reduce(acc += y)
       end
       acc
4642844</code></pre><p><strong>Possible concurrency primitive usages</strong></p><ul><li>Each channel is used solely for consuming or producing items (not both):<ul><li>User functions that only consumes items from channels that are produced by <code>Task</code>s outside the reduction.</li><li>User functions that only produces items to channels that have enough buffer size or are consumed by <code>Task</code>s outside the reduction.</li></ul></li><li>Locks that are acquired and released within an iteration.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaFolds/FoldsThreads.jl/blob/c51327fb643d7be88c646581293a98cbaf579827/src/misc.jl#L16-L80">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 26 January 2021 03:41">Tuesday 26 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
